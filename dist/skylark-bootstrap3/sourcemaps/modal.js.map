{"version":3,"sources":["modal.js"],"names":["define","langx","browser","eventer","noder","geom","velm","$","bs3","Plugin","option","_relatedTarget","this","each","$this","data","options","mixin","Modal","DEFAULTS","show","WidgetBase","inherit","klassName","init","element","$container","container","document","body","$element","$dialog","find","is","css","$backdrop","isShown","originalBodyPad","scrollbarWidth","ignoreBackdropClick","remote","load","proxy","trigger","toggle","hide","that","e","create","relatedTarget","isDefaultPrevented","checkScrollbar","setScrollbar","addClass","escape","resize","on","one","target","backdrop","transition","support","hasClass","isChildOf","appendTo","scrollTop","adjustDialog","offsetWidth","enforceFocus","transitionEnd","TRANSITION_DURATION","preventDefault","off","removeClass","hideModal","has","length","keyboard","which","window","handleUpdate","resetAdjustments","resetScrollbar","removeBackdrop","remove","callback","animate","doAnimate","createElement","currentTarget","focus","BACKDROP_TRANSITION_DURATION","callbackRemove","modalIsOverflowing","scrollHeight","documentElement","clientHeight","paddingLeft","bodyIsOverflowing","paddingRight","fullWindowWidth","innerWidth","documentElementRect","getBoundingClientRect","right","Math","abs","left","clientWidth","measureScrollbar","bodyPad","parseInt","style","scrollDiv","className","append","removeChild","VERSION","old","fn","modal","Constructor","noConflict"],"mappings":"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","file":"../modal.js","sourcesContent":["define([\n  \"skylark-langx/langx\",\n  \"skylark-utils-dom/browser\",\n  \"skylark-utils-dom/eventer\",\n  \"skylark-utils-dom/noder\",\n  \"skylark-utils-dom/geom\",\n  \"skylark-utils-dom/velm\",\n  \"skylark-utils-dom/query\",\n  \"./bs3\"\n],function(langx,browser,eventer,noder,geom,velm,$,bs3){\n\n/* ========================================================================\n * Bootstrap: modal.js v3.3.7\n * http://getbootstrap.com/javascript/#modals\n * ========================================================================\n * Copyright 2011-2016 Twitter, Inc.\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)\n * ======================================================================== */\n\n  'use strict';\n\n  // MODAL CLASS DEFINITION\n  // ======================\n\n  var Modal = bs3.Modal = bs3.WidgetBase.inherit({\n    klassName: \"Modal\",\n\n    init : function(element,options) {\n      this.options             = options;\n      this.$container               = $(options.container || document.body)\n      this.$element            = $(element)\n      this.$dialog             = this.$element.find('.modal-dialog')\n      if (!this.$container.is(\"body\")) {\n        this.$element.css(\"position\",\"absolute\");\n      }\n      //this.$container.append(this.$element);\n      this.$backdrop           = null\n      this.isShown             = null\n      this.originalBodyPad     = null\n      this.scrollbarWidth      = 0\n      this.ignoreBackdropClick = false\n\n      if (this.options.remote) {\n        this.$element\n          .find('.modal-content')\n          .load(this.options.remote, langx.proxy(function () {\n            this.$element.trigger('loaded.bs.modal')\n          }, this))\n      }\n    },\n\n    toggle : function (_relatedTarget) {\n      return this.isShown ? this.hide() : this.show(_relatedTarget)\n    },\n\n    show : function (_relatedTarget) {\n      var that = this\n      var e    = eventer.create('show.bs.modal', { relatedTarget: _relatedTarget })\n\n      this.$element.trigger(e)\n\n      if (this.isShown || e.isDefaultPrevented()) return\n\n      this.isShown = true\n\n      this.checkScrollbar()\n      this.setScrollbar()\n      this.$container.addClass('modal-open')\n\n      this.escape()\n      this.resize()\n\n      this.$element.on('click.dismiss.bs.modal', '[data-dismiss=\"modal\"]', langx.proxy(this.hide, this))\n\n      this.$dialog.on('mousedown.dismiss.bs.modal', function () {\n        that.$element.one('mouseup.dismiss.bs.modal', function (e) {\n          if ($(e.target).is(that.$element)) that.ignoreBackdropClick = true\n        })\n      })\n\n      this.backdrop(function () {\n        var transition = browser.support.transition && that.$element.hasClass('fade')\n\n        if (!noder.isChildOf(that.$element[0],that.$container[0])) {\n          that.$element.appendTo(that.$container) // don't move modals dom position\n        }\n\n        that.$element\n          .show()\n          .scrollTop(0)\n\n        that.adjustDialog()\n\n        if (transition) {\n          that.$element[0].offsetWidth // force reflow\n        }\n\n        that.$element.addClass('in')\n\n        that.enforceFocus()\n\n        var e = eventer.create('shown.bs.modal', { relatedTarget: _relatedTarget })\n\n        transition ?\n          that.$dialog // wait for modal to slide in\n            .one('transitionEnd', function () {\n              that.$element.trigger('focus').trigger(e)\n            })\n            .transitionEnd(Modal.TRANSITION_DURATION) :\n          that.$element.trigger('focus').trigger(e)\n      })\n    },\n\n    hide : function (e) {\n      if (e) e.preventDefault()\n\n      e = eventer.create('hide.bs.modal')\n\n      this.$element.trigger(e)\n\n      if (!this.isShown || e.isDefaultPrevented()) return\n\n      this.isShown = false\n\n      this.escape()\n      this.resize()\n\n      $(document).off('focusin.bs.modal')\n\n      this.$element\n        .removeClass('in')\n        .off('click.dismiss.bs.modal')\n        .off('mouseup.dismiss.bs.modal')\n\n      this.$dialog.off('mousedown.dismiss.bs.modal')\n\n      browser.support.transition && this.$element.hasClass('fade') ?\n        this.$element\n          .one('transitionEnd', langx.proxy(this.hideModal, this))\n          .transitionEnd(Modal.TRANSITION_DURATION) :\n        this.hideModal()\n    },\n\n    enforceFocus : function () {\n      $(document)\n        .off('focusin.bs.modal') // guard against infinite focus loop\n        .on('focusin.bs.modal', langx.proxy(function (e) {\n          if (document !== e.target &&\n              this.$element[0] !== e.target &&\n              !this.$element.has(e.target).length) {\n            this.$element.trigger('focus')\n          }\n        }, this))\n    },\n\n    escape : function () {\n      if (this.isShown && this.options.keyboard) {\n        this.$element.on('keydown.dismiss.bs.modal', langx.proxy(function (e) {\n          e.which == 27 && this.hide()\n        }, this))\n      } else if (!this.isShown) {\n        this.$element.off('keydown.dismiss.bs.modal')\n      }\n    },\n\n    resize : function () {\n      if (this.isShown) {\n        $(window).on('resize.bs.modal', langx.proxy(this.handleUpdate, this))\n      } else {\n        $(window).off('resize.bs.modal')\n      }\n    },\n\n    hideModal : function () {\n      var that = this\n      this.$element.hide()\n      this.backdrop(function () {\n        that.$container.removeClass('modal-open')\n        that.resetAdjustments()\n        that.resetScrollbar()\n        that.$element.trigger('hidden.bs.modal')\n      })\n    },\n\n    removeBackdrop : function () {\n      this.$backdrop && this.$backdrop.remove()\n      this.$backdrop = null\n    },\n\n    backdrop : function (callback) {\n      var that = this\n      var animate = this.$element.hasClass('fade') ? 'fade' : ''\n\n      if (this.isShown && this.options.backdrop) {\n        var doAnimate = browser.support.transition && animate\n\n        this.$backdrop = $(document.createElement('div'))\n          .addClass('modal-backdrop ' + animate)\n          .appendTo(this.$container)\n\n        if (!this.$container.is(\"body\")) {\n          this.$backdrop.css(\"position\",\"absolute\");\n        }\n\n\n        this.$element.on('click.dismiss.bs.modal', langx.proxy(function (e) {\n          if (this.ignoreBackdropClick) {\n            this.ignoreBackdropClick = false\n            return\n          }\n          if (e.target !== e.currentTarget) return\n          this.options.backdrop == 'static'\n            ? this.$element[0].focus()\n            : this.hide()\n        }, this))\n\n        if (doAnimate) this.$backdrop[0].offsetWidth // force reflow\n\n        this.$backdrop.addClass('in')\n\n        if (!callback) return\n\n        doAnimate ?\n          this.$backdrop\n            .one('transitionEnd', callback)\n            .transitionEnd(Modal.BACKDROP_TRANSITION_DURATION) :\n          callback()\n\n      } else if (!this.isShown && this.$backdrop) {\n        this.$backdrop.removeClass('in')\n\n        var callbackRemove = function () {\n          that.removeBackdrop()\n          callback && callback()\n        }\n        browser.support.transition && this.$element.hasClass('fade') ?\n          this.$backdrop\n            .one('transitionEnd', callbackRemove)\n            .transitionEnd(Modal.BACKDROP_TRANSITION_DURATION) :\n          callbackRemove()\n\n      } else if (callback) {\n        callback()\n      }\n    },\n\n    // these following methods are used to handle overflowing modals\n\n    handleUpdate : function () {\n      this.adjustDialog()\n    },\n\n    adjustDialog : function () {\n      var modalIsOverflowing = this.$element[0].scrollHeight > document.documentElement.clientHeight\n\n      this.$element.css({\n        paddingLeft:  !this.bodyIsOverflowing && modalIsOverflowing ? this.scrollbarWidth : '',\n        paddingRight: this.bodyIsOverflowing && !modalIsOverflowing ? this.scrollbarWidth : ''\n      })\n    },\n\n    resetAdjustments : function () {\n      this.$element.css({\n        paddingLeft: '',\n        paddingRight: ''\n      })\n    },\n\n    checkScrollbar : function () {\n      var fullWindowWidth = window.innerWidth\n      if (!fullWindowWidth) { // workaround for missing window.innerWidth in IE8\n        var documentElementRect = document.documentElement.getBoundingClientRect()\n        fullWindowWidth = documentElementRect.right - Math.abs(documentElementRect.left)\n      }\n      this.bodyIsOverflowing = document.body.clientWidth < fullWindowWidth\n      this.scrollbarWidth = this.measureScrollbar()\n    },\n\n    setScrollbar : function () {\n      var bodyPad = parseInt((this.$container.css('padding-right') || 0), 10)\n      this.originalBodyPad = document.body.style.paddingRight || ''\n      if (this.bodyIsOverflowing) this.$container.css('padding-right', bodyPad + this.scrollbarWidth)\n    },\n\n    resetScrollbar : function () {\n      this.$container.css('padding-right', this.originalBodyPad)\n    },\n\n    measureScrollbar : function () { // thx walsh\n      var scrollDiv = document.createElement('div')\n      scrollDiv.className = 'modal-scrollbar-measure'\n      this.$container.append(scrollDiv)\n      var scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth\n      this.$container[0].removeChild(scrollDiv)\n      return scrollbarWidth\n    }\n\n  });  \n\n\n  Modal.VERSION  = '3.3.7'\n\n  Modal.TRANSITION_DURATION = 300\n  Modal.BACKDROP_TRANSITION_DURATION = 150\n\n  Modal.DEFAULTS = {\n    backdrop: true,\n    keyboard: true,\n    show: true\n  }\n\n\n\n  // MODAL PLUGIN DEFINITION\n  // =======================\n\n  function Plugin(option, _relatedTarget) {\n    return this.each(function () {\n      var $this   = $(this)\n      var data    = $this.data('bs.modal')\n      var options = langx.mixin({}, Modal.DEFAULTS, $this.data(), typeof option == 'object' && option)\n\n      if (!data) $this.data('bs.modal', (data = new Modal(this, options)))\n      if (typeof option == 'string') data[option](_relatedTarget)\n      else if (options.show) data.show(_relatedTarget)\n    })\n  }\n\n  var old = $.fn.modal\n\n  $.fn.modal             = Plugin;\n  $.fn.modal.Constructor = Modal;\n\n\n  // MODAL NO CONFLICT\n  // =================\n\n  $.fn.modal.noConflict = function () {\n    $.fn.modal = old\n    return this\n  }\n\n\n  return $.fn.modal;\n});\n"]}