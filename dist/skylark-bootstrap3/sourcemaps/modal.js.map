{"version":3,"sources":["modal.js"],"names":["define","langx","browser","eventer","noder","geom","$","plugins","bs3","Modal","Plugin","inherit","klassName","pluginName","_construct","element","options","mixin","DEFAULTS","data","this","overrided","$container","container","document","body","$element","$dialog","find","is","css","$backdrop","isShown","originalBodyPad","scrollbarWidth","ignoreBackdropClick","remote","load","proxy","trigger","show","toggle","_relatedTarget","hide","that","e","create","relatedTarget","isDefaultPrevented","checkScrollbar","setScrollbar","addClass","escape","resize","on","one","target","backdrop","transition","support","hasClass","isChildOf","appendTo","scrollTop","adjustDialog","offsetWidth","enforceFocus","emulateTransitionEnd","TRANSITION_DURATION","preventDefault","off","removeClass","hideModal","has","length","keyboard","which","window","handleUpdate","resetAdjustments","resetScrollbar","removeBackdrop","remove","callback","animate","doAnimate","createElement","currentTarget","focus","BACKDROP_TRANSITION_DURATION","callbackRemove","modalIsOverflowing","scrollHeight","documentElement","clientHeight","paddingLeft","bodyIsOverflowing","paddingRight","fullWindowWidth","innerWidth","documentElementRect","getBoundingClientRect","right","Math","abs","left","clientWidth","measureScrollbar","bodyPad","parseInt","style","scrollDiv","className","append","removeChild","VERSION","register"],"mappings":"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","file":"../modal.js","sourcesContent":["define([\n  \"skylark-langx/langx\",\n  \"skylark-domx-browser\",\n  \"skylark-domx-eventer\",\n  \"skylark-domx-noder\",\n  \"skylark-domx-geom\",\n  \"skylark-domx-query\",\n  \"skylark-domx-plugins-base\",\n  \"./bs3\"\n],function(langx,browser,eventer,noder,geom,$,plugins,bs3){\n\n/* ========================================================================\n * Bootstrap: modal.js v3.3.7\n * http://getbootstrap.com/javascript/#modals\n * ========================================================================\n * Copyright 2011-2016 Twitter, Inc.\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)\n * ======================================================================== */\n\n  'use strict';\n\n  // MODAL CLASS DEFINITION\n  // ======================\n\n  var Modal = bs3.Modal = plugins.Plugin.inherit({\n    klassName: \"Modal\",\n\n    pluginName : \"bs3.modal\",\n\n    _construct : function(element,options) {\n      options = langx.mixin({}, Modal.DEFAULTS, $(element).data(), options)\n      this.overrided(element,options);\n      this.$container               = $(options.container || document.body)\n      this.$element            = $(element)\n      this.$dialog             = this.$element.find('.modal-dialog')\n      if (!this.$container.is(\"body\")) {\n        this.$element.css(\"position\",\"absolute\");\n      }\n      //this.$container.append(this.$element);\n      this.$backdrop           = null\n      this.isShown             = null\n      this.originalBodyPad     = null\n      this.scrollbarWidth      = 0\n      this.ignoreBackdropClick = false\n\n      if (this.options.remote) {\n        this.$element\n          .find('.modal-content')\n          .load(this.options.remote, langx.proxy(function () {\n            this.$element.trigger('loaded.bs.modal')\n          }, this))\n      }\n\n      if (this.options.show) {\n        this.show();\n      }\n    },\n\n    toggle : function (_relatedTarget) {\n      return this.isShown ? this.hide() : this.show(_relatedTarget)\n    },\n\n    show : function (_relatedTarget) {\n      var that = this\n      var e    = eventer.create('show.bs.modal', { relatedTarget: _relatedTarget })\n\n      this.$element.trigger(e)\n\n      if (this.isShown || e.isDefaultPrevented()) return\n\n      this.isShown = true\n\n      this.checkScrollbar()\n      this.setScrollbar()\n      this.$container.addClass('modal-open')\n\n      this.escape()\n      this.resize()\n\n      this.$element.on('click.dismiss.bs.modal', '[data-dismiss=\"modal\"]', langx.proxy(this.hide, this))\n\n      this.$dialog.on('mousedown.dismiss.bs.modal', function () {\n        that.$element.one('mouseup.dismiss.bs.modal', function (e) {\n          if ($(e.target).is(that.$element)) that.ignoreBackdropClick = true\n        })\n      })\n\n      this.backdrop(function () {\n        var transition = browser.support.transition && that.$element.hasClass('fade')\n\n        if (!noder.isChildOf(that.$element[0],that.$container[0])) {\n          that.$element.appendTo(that.$container) // don't move modals dom position\n        }\n\n        that.$element\n          .show()\n          .scrollTop(0)\n\n        that.adjustDialog()\n\n        if (transition) {\n          that.$element[0].offsetWidth // force reflow\n        }\n\n        that.$element.addClass('in')\n\n        that.enforceFocus()\n\n        var e = eventer.create('shown.bs.modal', { relatedTarget: _relatedTarget })\n\n        transition ?\n          that.$dialog // wait for modal to slide in\n            .one('transitionEnd', function () {\n              that.$element.trigger('focus').trigger(e)\n            })\n            .emulateTransitionEnd(Modal.TRANSITION_DURATION) :\n          that.$element.trigger('focus').trigger(e)\n      })\n    },\n\n    hide : function (e) {\n      if (e) e.preventDefault()\n\n      e = eventer.create('hide.bs.modal')\n\n      this.$element.trigger(e)\n\n      if (!this.isShown || e.isDefaultPrevented()) return\n\n      this.isShown = false\n\n      this.escape()\n      this.resize()\n\n      $(document).off('focusin.bs.modal')\n\n      this.$element\n        .removeClass('in')\n        .off('click.dismiss.bs.modal')\n        .off('mouseup.dismiss.bs.modal')\n\n      this.$dialog.off('mousedown.dismiss.bs.modal')\n\n      browser.support.transition && this.$element.hasClass('fade') ?\n        this.$element\n          .one('transitionEnd', langx.proxy(this.hideModal, this))\n          .emulateTransitionEnd(Modal.TRANSITION_DURATION) :\n        this.hideModal()\n    },\n\n    enforceFocus : function () {\n      $(document)\n        .off('focusin.bs.modal') // guard against infinite focus loop\n        .on('focusin.bs.modal', langx.proxy(function (e) {\n          if (document !== e.target &&\n              this.$element[0] !== e.target &&\n              !this.$element.has(e.target).length) {\n            this.$element.trigger('focus')\n          }\n        }, this))\n    },\n\n    escape : function () {\n      if (this.isShown && this.options.keyboard) {\n        this.$element.on('keydown.dismiss.bs.modal', langx.proxy(function (e) {\n          e.which == 27 && this.hide()\n        }, this))\n      } else if (!this.isShown) {\n        this.$element.off('keydown.dismiss.bs.modal')\n      }\n    },\n\n    resize : function () {\n      if (this.isShown) {\n        $(window).on('resize.bs.modal', langx.proxy(this.handleUpdate, this))\n      } else {\n        $(window).off('resize.bs.modal')\n      }\n    },\n\n    hideModal : function () {\n      var that = this\n      this.$element.hide()\n      this.backdrop(function () {\n        that.$container.removeClass('modal-open')\n        that.resetAdjustments()\n        that.resetScrollbar()\n        that.$element.trigger('hidden.bs.modal')\n      })\n    },\n\n    removeBackdrop : function () {\n      this.$backdrop && this.$backdrop.remove()\n      this.$backdrop = null\n    },\n\n    backdrop : function (callback) {\n      var that = this\n      var animate = this.$element.hasClass('fade') ? 'fade' : ''\n\n      if (this.isShown && this.options.backdrop) {\n        var doAnimate = browser.support.transition && animate\n\n        this.$backdrop = $(document.createElement('div'))\n          .addClass('modal-backdrop ' + animate)\n          .appendTo(this.$container)\n\n        if (!this.$container.is(\"body\")) {\n          this.$backdrop.css(\"position\",\"absolute\");\n        }\n\n\n        this.$element.on('click.dismiss.bs.modal', langx.proxy(function (e) {\n          if (this.ignoreBackdropClick) {\n            this.ignoreBackdropClick = false\n            return\n          }\n          if (e.target !== e.currentTarget) return\n          this.options.backdrop == 'static'\n            ? this.$element[0].focus()\n            : this.hide()\n        }, this))\n\n        if (doAnimate) this.$backdrop[0].offsetWidth // force reflow\n\n        this.$backdrop.addClass('in')\n\n        if (!callback) return\n\n        doAnimate ?\n          this.$backdrop\n            .one('transitionEnd', callback)\n            .emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION) :\n          callback()\n\n      } else if (!this.isShown && this.$backdrop) {\n        this.$backdrop.removeClass('in')\n\n        var callbackRemove = function () {\n          that.removeBackdrop()\n          callback && callback()\n        }\n        browser.support.transition && this.$element.hasClass('fade') ?\n          this.$backdrop\n            .one('transitionEnd', callbackRemove)\n            .emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION) :\n          callbackRemove()\n\n      } else if (callback) {\n        callback()\n      }\n    },\n\n    // these following methods are used to handle overflowing modals\n\n    handleUpdate : function () {\n      this.adjustDialog()\n    },\n\n    adjustDialog : function () {\n      var modalIsOverflowing = this.$element[0].scrollHeight > document.documentElement.clientHeight\n\n      this.$element.css({\n        paddingLeft:  !this.bodyIsOverflowing && modalIsOverflowing ? this.scrollbarWidth : '',\n        paddingRight: this.bodyIsOverflowing && !modalIsOverflowing ? this.scrollbarWidth : ''\n      })\n    },\n\n    resetAdjustments : function () {\n      this.$element.css({\n        paddingLeft: '',\n        paddingRight: ''\n      })\n    },\n\n    checkScrollbar : function () {\n      var fullWindowWidth = window.innerWidth\n      if (!fullWindowWidth) { // workaround for missing window.innerWidth in IE8\n        var documentElementRect = document.documentElement.getBoundingClientRect()\n        fullWindowWidth = documentElementRect.right - Math.abs(documentElementRect.left)\n      }\n      this.bodyIsOverflowing = document.body.clientWidth < fullWindowWidth\n      this.scrollbarWidth = this.measureScrollbar()\n    },\n\n    setScrollbar : function () {\n      var bodyPad = parseInt((this.$container.css('padding-right') || 0), 10)\n      this.originalBodyPad = document.body.style.paddingRight || ''\n      if (this.bodyIsOverflowing) this.$container.css('padding-right', bodyPad + this.scrollbarWidth)\n    },\n\n    resetScrollbar : function () {\n      this.$container.css('padding-right', this.originalBodyPad)\n    },\n\n    measureScrollbar : function () { // thx walsh\n      var scrollDiv = document.createElement('div')\n      scrollDiv.className = 'modal-scrollbar-measure'\n      this.$container.append(scrollDiv)\n      var scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth\n      this.$container[0].removeChild(scrollDiv)\n      return scrollbarWidth\n    }\n\n  });  \n\n\n  Modal.VERSION  = '3.3.7'\n\n  Modal.TRANSITION_DURATION = 300\n  Modal.BACKDROP_TRANSITION_DURATION = 150\n\n  Modal.DEFAULTS = {\n    backdrop: true,\n    keyboard: true,\n    show: true\n  }\n\n  /*\n\n  // MODAL PLUGIN DEFINITION\n  // =======================\n\n  function Plugin(option, _relatedTarget) {\n    return this.each(function () {\n      var $this   = $(this)\n      var data    = $this.data('bs.modal')\n      var options = langx.mixin({}, Modal.DEFAULTS, $this.data(), typeof option == 'object' && option)\n\n      if (!data) $this.data('bs.modal', (data = new Modal(this, options)))\n      if (typeof option == 'string') data[option](_relatedTarget)\n      else if (options.show) data.show(_relatedTarget)\n    })\n  }\n\n  var old = $.fn.modal\n\n  $.fn.modal             = Plugin;\n  $.fn.modal.Constructor = Modal;\n\n\n  // MODAL NO CONFLICT\n  // =================\n\n  $.fn.modal.noConflict = function () {\n    $.fn.modal = old\n    return this\n  }\n\n\n  return $.fn.modal;\n  */\n\n  plugins.register(Modal,\"modal\",function(options,_relatedTarget){\n      //this -> plugin instance\n      if (typeof options == 'string') {\n        this[options](_relatedTarget);\n      } else if (this.options.show) {\n        this.show(_relatedTarget);\n      } \n  });\n\n  return Modal;\n\n});\n"]}